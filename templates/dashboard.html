{% extends "base_template.html" %}

{% block title %}Modelr &middot; Dashboard{% endblock %}

{% block content %}

<div class="container">
  <div class="row">
    


    <ul class="nav nav-tabs">
      <li class="active"><a href="#feed" data-toggle="tab">Feed</a></li>
      <li><a href="#rocks" data-toggle="tab">Rocks</a></li>
      <li><a href="#scenarios" data-toggle="tab">Scenarios</a></li>
      <li><a href="#models" data-toggle="tab">Section Models</a></li>
    </ul>
    

    <div class="tab-content">
      <div class="tab-pane" id="scenarios">
	<div class="panel panel-primary">
	  <div class="panel-heading">
            <h3 class="panel-title">Scenarios</h3>
	  </div>
	  <div class="panel-body">
	    <table class="table table-condensed table-hover">
              <tbody>
		{% for scenario in scenarios %}
		
		<tr>
		  <form class="form-horizontal" name="input" action="remove_scenario" method="post">
		    <input type="hidden" name="name" value="{{scenario.name}}" />
		    <td><strong><a href='/scenario#{{scenario.name}}'>{{scenario.name}}</a></strong></td>
                    <td>{{scenario.script}}</td>
                    <td> <a class="btn btn-success btn-xs" href="/scenario#{{scenario.name}}" > edit&nbsp;</a> &nbsp;&nbsp;<input class="btn btn-danger btn-xs" type="submit" value="remove" /></td>
                    
		  </form>
		</tr>
		{% endfor %}
              </tbody>
            </table>
            <a class="btn btn-primary" href="/scenario" role="button">Make a new scenario</a>
	  </div>
	</div>
      </div>


<!-- Start of right-hand column -->

      <div class="tab-pane" id="rocks">
      <div class="col-md-8">
	<div class="panel panel-default">
	  <div class="panel-heading">
            <h3 class="panel-title">My rocks</h3>
	  </div>
	  <div class="panel-body">
	    <table class="table table-condensed table-hover">
              <thead>
		<tr>
		  <th></th>
		  <th>V<sub>P</sub></th>
		  <th>V<sub>S</sub></th>
		  <th>Rho</th>
		  <th>V<sub>P</sub> std</th>
		  <th>V<sub>S</sub> std</th>
		  <th>Rho std</th>
		  <th></th>
		</tr>
              </thead>
              <tbody>
		{% for rock in rocks %}
		<tr>
		  <form class="form-horizontal" name="input" action="edit_rock" method="post">
		    <input type="hidden" name="name" value="{{rock.name}}" />
		    <td><strong>{{rock.name}}</strong></td>
                    <td>{{rock.vp}}</td>
                    <td>{{rock.vs}}</td>
                    <td>{{rock.rho}}</td>
                    <td>{{rock.vp_std}}</td>
                    <td>{{rock.vs_std}}</td>
                    <td>{{rock.rho_std}}</td>
                    <td><input class="btn btn-success btn-xs" type="submit" name="action" value="edit">&nbsp;&nbsp;&nbsp;&nbsp;<input class="btn btn-danger btn-xs" type="submit" formaction="/remove_rock" method="post" value="remove" /></td>
		  </form>
		</tr>
		{% endfor %}
              </tbody>
            </table>
	  </div>
	</div>

	{% for rock_group in rock_groups %}
	<div class="panel panel-default">
	  <div class="panel-heading">
            <h3 class="panel-title">{{rock_group['name']}} rocks</h3>
	  </div>
	  <div class="panel-body">
            <table class="table table-condensed table-hover">
              <thead>
		<tr>
		  <th></th>
		  <th>V<sub>P</sub></th>
		  <th>V<sub>S</sub></th>
		  <th>Rho</th>
		  <th>V<sub>P</sub> std</th>
		  <th>V<sub>S</sub> std</th>
		  <th>Rho std</th>
		  <th></th>
		</tr>
              </thead>
              <tbody>
		{% for rock in rock_group['rocks'] %}
		<tr>
		  <input type="hidden" name="name" value="{{rock.name}}" />
		  <td><strong>{{rock.name}}</strong></td>
		  <td>{{rock.vp}}</td>
		  <td>{{rock.vs}}</td>
		  <td>{{rock.rho}}</td>
		  <td>{{rock.vp_std}}</td>
		  <td>{{rock.vs_std}}</td>
		  <td>{{rock.rho_std}}</td>

		</tr>
		{% endfor %}
              </tbody>
            </table>
	  </div>
	</div>
	{% endfor %}


	<div class="panel panel-default" id="accordion">
	  <div class="panel-heading">
            <h3 class="panel-title"><a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion" href="#collapseDefault" data-toggle="collapse">
              <i class="indicator glyphicon glyphicon-chevron-down pull-right" style="color:gray;"></i> Default rocks</a>
            </h3>
	  </div>
	  <div class="panel-body panel-collapse collapse" id="collapseDefault">
	    <table class="table table-condensed table-hover">
              <thead>
		<tr>
		  <th></th>
		  <th>V<sub>P</sub></th>
		  <th>V<sub>S</sub></th>
		  <th>Rho</th>
		  <th>V<sub>P</sub> std</th>
		  <th>V<sub>S</sub> std</th>
		  <th>Rho std</th>
		  <th></th>
		</tr>
              </thead>
              <tbody>
		{% for rock in default_rocks %}
		<tr>
		  <input type="hidden" name="name" value="{{rock.name}}" />
		  <td><strong>{{rock.name}}</strong></td>
		    <td>{{rock.vp}}</td>
		    <td>{{rock.vs}}</td>
		    <td>{{rock.rho}}</td>
		    <td>{{rock.vp_std}}</td>
		    <td>{{rock.vs_std}}</td>
		    <td>{{rock.rho_std}}</td>
		</tr>
		{% endfor %}
              </tbody>
            </table>
	  </div> <!-- end of panel body -->
	</div> <!-- end of panel -->

	<div class="panel panel-default">
	  <div class="panel-heading">
	    <h3 class="panel-title">Add rock</h3>
	  </div>
	  <div class="panel-body">
	    <form name="input" action="add_rock" method="post">
	      <form class="form-horizontal" role="form">

		<div class="form-group">
		  <label for="name" class="col-sm-2 control-label">Name</label>
		  <div class="col-sm-10">
		    <input class="form-control" type="text" name="name" value={{current_rock.name}} placeholder=""/>
		  </div>
		</div>
		
		<div class="form-group">
		  <label for="description" class="col-sm-2 control-label">Description</label>
		  <div class="col-sm-10">
		    <input class="form-control" type="text" name="description" value={{current_rock.description}} />
		  </div>
		</div>

		<div class="form-group">
		  <label for="description" class="col-sm-2 control-label">Rho</label>
		  <div class="col-sm-10">
		    <input class="form-control" type="text" name="rho" value={{current_rock.rho}} />
		  </div>
		</div>

		<div class="form-group">
		  <label for="description" class="col-sm-2 control-label">V<sub>P</sub></label>
		  <div class="col-sm-10">
		    <input class="form-control" type="text" name="vp" value={{current_rock.vp}} />
		  </div>
		</div>

		<div class="form-group">
		  <label for="description" class="col-sm-2 control-label">V<sub>S</sub></label>
		  <div class="col-sm-10">
		    <input class="form-control" type="text" name="vs" value={{current_rock.vs}}  />
		  </div>
		</div>

		<div class="form-group">
		  <label for="description" class="col-sm-2 control-label">Rho std</label>
		  <div class="col-sm-10">
		    <input class="form-control" type="text" name="rho_std" value={{current_rock.rho_std}} />
		  </div>
		</div>

		<div class="form-group">
		  <label for="description" class="col-sm-2 control-label">V<sub>P</sub> std</label>
		  <div class="col-sm-10">
		    <input class="form-control" type="text" name="vp_std" value={{current_rock.vp_std}} />
		  </div>
		</div>

		<div class="form-group">
		  <label for="description" class="col-sm-2 control-label">V<sub>S</sub> std</label>
		  <div class="col-sm-10">
		    <input class="form-control" type="text" name="vs_std" value={{current_rock.vs_std}} />
		  </div>
		</div>

		<div class="form-group">
		  <label for="description" class="col-sm-2 control-label">Share</label>
		  <div class="col-sm-10">
		    <select name="group">
		      <option value="private">Private</option>
		      {% for group in user.group %}
		      <option value={{group}} {% if group==current_rock.group %} selected {% endif %}>{{group.capitalize()}}</option>
		      {% endfor %}
		    </select>
		  </div>
		</div>
		
		<div class="form-group">
		  <div class="col-sm-offset-2 col-sm-10">
		    <button type="submit" class="btn btn-default">Add this rock</button>
		  </div>
		</div>
		
	      </form>
	    </form>
	  </div> <!-- end of panel body -->
	</div> <!-- end of panel  -->
      </div>
    </div>


<div class="tab-pane active" id="feed">
    <div class="col-md-4">
      
      <div class="panel panel-default">
	<div class="panel-heading">
          <h3 class="panel-title">Welcome</h3>
	</div>
	<div class="panel-body">
          <p><strong>Welcome to Modelr!</strong></p><p> To get started, try our <a href="/section_model">section modelr</a> or <a href="/scenario">scenario</a> pages. Use the tabs on the right to manage your rocks and models!</p>
          <p><a href="/help">Need more help?</a></p>
	</div>
      </div>
    </div>
</div>

<div class="tab-pane" id="models">

  <div class="panel panel-primary">
    <div class="panel-heading">
      <h3 class="panel-title">Section Models</h3>
    </div>
    <p><b>Manage your uploaded images and saved section models.   
      Note: Deleting an image will remove all associated models.</b></p>
  </div>
    <hr>

  {% for img in models %}
 <div class="row" id="{{img['image_key']}}">

            <div class="col-lg-2 col-md-2">
	      
                <a href="/section_model#image_key={{img['image_key']}}">
                    <img class="img-responsive" src="{{img['image']}}" alt="" >
                </a>
		<button class="btn btn-success btn-xs" href="/section_model#image_key={{img['image_key']}}">open image</button>
		{% if img.editable %}
		<button class="btn btn-danger btn-xs" onclick='delete_image("{{img['image_key']}}")'>delete image</button>
		{% endif %}
		
	    </div>

            <div class="col-lg-5 col-md-5">
	      
                <tr>
                {% for model in img["models"] %}
	      <div class="row">
                <td><strong><a href="/section_model#image_key={{img['image_key']}}&name={{model.name}}">{{model.name}}</a></strong></td>
		<td> <a class="btn btn-success btn-xs" href="/section_model#image_key={{img['image_key']}}&name={{model.name}}" > open&nbsp;</a> &nbsp;&nbsp;</td>
		<button class="btn btn-danger btn-xs" 
			onclick='delete_model("{{img['image_key']}}","{{model.name}}", this.parentNode)'>delete</button>
	      </div>
		{% endfor%}
	      
            </div>

        </div>
	<hr>
	{% endfor %}
    </div>
</div>
    </div>

<script>

// Show tabs on clicking
$('.tabbable .nav-tabs a').click(function (e) {
  e.preventDefault();
  $(this).tab('show');
  });
  


function delete_model(image_key, model_name, element){

   callback = function(data){

     if (JSON.parse(data)["success"]){
	 element.parentNode.removeChild(element);
	 };
   };

   $.ajax('/earth_model?input_image_id=' + image_key + '&' + 'name=' + model_name,
	  {type: "DELETE",
	   success: callback});
 };

function delete_image(image_key){

   callback = function(data){

    var elem = document.getElementById(image_key);
    elem.parentNode.removeChild(elem);
   }
  
   $.ajax('/image_model?image_key=' + image_key, {type:"DELETE",
						  success: callback});

};


</script>

<script>
 $(document).ready(function() {
   

   var activeTab = $('[href=' + location.hash + ']');
   activeTab && activeTab.tab('show');


   function toggleChevron(e) {
     $(e.target)
        .prev('.panel-heading')
        .find('i.indicator')
        .toggleClass('glyphicon-chevron-down glyphicon-chevron-up');
   }
   $('#accordion').on('hidden.bs.collapse', toggleChevron);
   $('#accordion').on('shown.bs.collapse', toggleChevron);
 });

</script>


{% endblock %}

