{% extends "base_template.html" %} 
{% block title %}Modelr &middot; Section model{% endblock %} 

{% block content %}



<div class="container">
  <!-- JAVASCRIPT and DATA
  =================================================================-->

  <script>
   var host = '{{HOSTNAME}}';
  </script>

  <script>

   $(document).ready(function() {
     
     server = new PlotServer(host, null);
     modelbuilder = new Scenario(name, null, {}, null);

     modelbuilder.display = display_form;

     modelbuilder.set_current_script = function(value, argumentss){
       modelbuilder.script = 'fluid_model.py';
       console.log('server.current_script');

       server.get_script_info(value, 'model_builder',
		       function(data){
	   
	   modelbuilder.info = data;
	   modelbuilder.default_args(argumentss);
	   console.log('div#builder_place');
	   
	   modelbuilder.display('div#builder_place');
	   modelbuilder.on_change();
	 }  
		       )

       // Select the script in the 'select' element of this page.  
       $("select#select_script option").filter(function() {
         //may want to use $.trim in here
         return $(this).val() == value; 
       }).attr('selected', true);

     }
     
     modelbuilder.save_model = function save_model(){

       success = function(data){
	 window.location.href='/model'
       }

       image = $('img#plot_image').attr('src');

       $.post('/model_builder',{'image': image}, success);
     }
     
     modelbuilder.on_change = function update_link(){
       
       var qs = modelbuilder.qs();
       var url = (server.hostname +'/plot.json' + qs + 
		  '&type=model_builder');
       
       var p = $('p#image_link');
       p.text(url);
       p.attr('href', url)  
     }
  
     modelbuilder.set_current_script('fluid_model.py',
				     modelbuilder.arguments);

     // This is specific to this display.
     server.update_image = function(modelbuilder){
       var qs = modelbuilder.qs();
       var url = server.hostname +'/plot.json' + qs;
       $.get(url, {type:'model_builder'},function(data){
	 
	 image = data.data
	 // use the GAE server to blend the images
	 $.get("/fluid_builder?blend=1", 
	       {image: image, 
		rock_image_key: "{{rock_image_key}}"},
	       function(data){
	       $('img#plot_image').attr('src', 
					"data:image/png;base64, " 
					+ data); 
	       });
       
         $('#fluid_image').attr('value', image);
       });

      
   
       
     }
     

   });

  </script>


  <!-- MODEL PANEL
  =================================================================-->
  <div class="row">

  <div class="col-md-6">
    <div class="panel panel-default">
	    <div class="panel-heading">
        <h3 class="panel-title">Fluid model builder</h3>
	    </div>
	
    	<div class="panel-body">
    	  <img class="img-thumbnail" id="example_image"
    	       src="/static/img/mb_example.png">

          <!-- Div to place the form into see builder.display and display_form functions-->
          <div style="margin:16px 0 16px 0;" id="builder_place">
          </div>
        
          <div class="form-group">
            
              <button class="btn btn-primary" id='create_image' 
                       onclick="server.update_image(modelbuilder)">
                Create image
              </button>
          </div>
    	</div>  <!-- end of panel-body -->
    </div> <!-- end of panel -->
  </div> <!-- end of col -->
    
  <!-- RESULT PANEL
  ===============================================================-->

    <div class="col-md-6">
      <div class="panel panel-default">
	<div class="panel-heading">
          <h3 class="panel-title">Result</h3>
	</div>
	<div class="panel-body">
          <!-- Updated by the  create_image button above-->
          <img class="img-thumbnail" id="plot_image" 
               alt="Placeholder" 
src="/static/img/placeholder_model_image.png" />

          <div style="margin-top:16px;" class="form-group">
            <form action="/fluid_builder" method="post">
              <input type="hidden" id="URL" name="URL">
	      <input type="hidden" id="fluid_image" 
		     name="fluid_image">
	      <input type="hidden" name="rock_image_key"
		     id="rock_image_key" value="{{rock_image_key}}">
	      <div class=col-xs-10>
		<input placeholder="Fluid model name" 
		       class="form-control"
		       maxlength="20"
		       id="fluid_model_name"
		       name="fluid_model_name">
	      </div>
	      <button class="btn btn-default" type="submit">
                Save
              </button>
            </form>
          </div>
        </div> <!-- end of panel body -->
      </div> <!-- end of panel -->
    </div> <!-- end of col -->

  </div> <!-- end of row -->

 
  {% endblock %}

