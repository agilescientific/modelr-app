{% extends "base_template.html" %} 
{% block title %}Modelr &middot;Â Scenario{% endblock %} 

{% block content %}

<!-- JAVASCRIPT and DATA
====================================================================================== -->

<script type="text/javascript">
<!-- 
var host = '{{HOSTNAME}}';
-->
</script>

<script type="text/javascript">
<!--

    $(document).ready(function() {
        
        server = new PlotServer(host, get_rocks('datalist#list_of_rocks'));
        scenario = new Scenario(name, null, {}, server.rocks);
        
        // This is specific to this page. will create a form.
        scenario.display = display_form;
        
        // This is specific to this page.
        // Used by the script select element + the get method of Scenario.
        scenario.set_current_script = function(value, argumentss){

            scenario.script = value;
            
            console.log('server.current_script');
            
            server.get_script_info(value, function(data){
                scenario.info = data;
                scenario.default_args(argumentss);
                
                console.log('div#scenario_place');
                
                // This will Create a form see above
                scenario.display('div#scenario_place');
                
                scenario.on_change();
            })
            
            // Select the script in the 'select' element of this page.  
            $("select#select_script option").filter(function() {
                //may want to use $.trim in here
                return $(this).val() == value; 
            }).attr('selected', true);

        }
        
        // This is specific to this display.
	    server.update_img = function(scenario){
	    
            var qs = scenario.qs();
	        var url = server.hostname +'/plot.jpeg' + qs;
            var img = $('img#plot_image');
            img.attr('src', url);
            
	    }
        
        scenario.on_change = function update_link(){
            
            var qs = scenario.qs();
	        var url = server.hostname +'/plot.jpeg' + qs;
	        
            var p = $('p#image_link');
            p.text(url);
        }
	    
        /* This populates the scripts dropdown with a list of scripts
        from the plot server.
        */
        populate_scripts(server, 'select#select_script');

        /*
        This grabs the data after the '#' in the url and updates the current
        scenario.
        */
        var hash = window.location.hash.substring(1);
        
        if (hash != ''){
            scenario.name = hash;
            
            // Get the scenario from google app engine.
            scenario.get();
            $('input#scenario_name').val(hash);
        }
	    
    });
    -->
</script>

<!-- This will expand the list of rocks before google app engine sends this page to the user -->
<!-- This list is used by javascript and not directly seen by the user -->
<datalist id="list_of_rocks">
	{% for rock in rocks %}
	<option data-value="{{rock.vp}},{{rock.rho}},{{rock.vs}},{{rock.vp_std}}, {{rock.vs_std}}, {{rock.rho_std}}"
		data-name="{{rock.name}}">{{rock.name}}</option>
	{% endfor %}
        {% for rock in default_rocks %}
	<option data-value="{{rock.vp}},{{rock.rho}},{{rock.vs}},{{rock.vp_std}}, {{rock.vs_std}}, {{rock.rho_std}}"
		data-name="{{rock.name}}">{{rock.name}}</option>
	{% endfor %}
	
</datalist>

<!-- SCENARIO PANEL
====================================================================================== -->
<div class="row">

  <div class="col-md-6">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Scenario</h3>
      </div>
      
      <div class="panel-body">
      
        <form class="form-horizontal" role="form">
        
          <div class="form-group">
            <label for="scenario_name" class="col-sm-2 control-label">Scenario</label>
            <div class="col-sm-6">
              <input class="form-control" id='scenario_name' onchange="scenario.name = this.value;"></input>
              <button class="btn btn-default" onclick="scenario.put()">
                Save
              </button>
              <button class="btn btn-default" onclick="scenario.get()">
                Load
              </button>
            </div>
          </div>

          <div class="form-group">
            <label for="select_script" class="col-sm-2 control-label">Script</label>
            <div class="col-sm-6">
              <select class="form-control" id="select_script" onchange="scenario.set_current_script($(this).val(), scenario.arguments)">
              <option>Please wait... </option>
              </select>
              <div class="col-sm-4">
                <button class="btn btn-default" type="button" onclick="populate_scripts(server, 'select#select_script')">
                  refresh
                </button>
              </div>
            </div>
          </div>
  
          <!-- Div to place the form into see Scenario.display and display_form functions-->
          <div class="container" id="scenario_place">
          </div>
  
          <div class="form-group">
            <div class="col-sm-offset-2 col-sm-6">
              <button class="btn btn-default" id='create_image' onclick="server.update_img(scenario)">
                Create image
              </button>
            </div>
          </div>

        </form>

      </div>  <!-- end of panel-body -->
    </div>
  </div>
  
<!-- RESULT PANEL
====================================================================================== -->

  <div class="col-md-6">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Result</h3>
      </div>
      <div class="panel-body">

        <img class="img-thumbnail" id="plot_image" href=URL alt="Plot image">
          <!-- Updated by the  create_image button above-->
        </img>

      </div>
    </div>
  </div>

</div>

<!-- URL PANEL
====================================================================================== -->

<div class="row">
  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">URL</h3>
      </div>
      <div class="panel-body">
        <!-- Create and display the image / see the user defined server.update_img -->
        <p id="image_link" style="font-size: 10px;">URL</p>
      </div>
    </div>
  </div>
</div>

{% endblock %}
